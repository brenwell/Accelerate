#!/bin/bash
PATH=./node_modules/.bin:$PATH

WEBPACK=./node_modules/.bin/webpack
INDEXJS=./src/index.js
BUNDLE=./dist/accelerate.js
BUNDLE_MIN=./dist/accelerate.min.js

function public:start {
  rm -rf ./lib/
  ${WEBPACK} --progress --colors --watch --env.fileName 'suga.js' --env.libName 'suga'
}

function public:clean {
  rm -Rfv ./dist/*
}

function public:watch {
  ${WEBPACK} --progress -w --colors ${INDEXJS} ${BUNDLE}
  ${WEBPACK} --progress -w --colors ${INDEXJS} ${BUNDLE_MIN}
}
function public:build {
  ${WEBPACK} --progress --colors ${INDEXJS} ${BUNDLE}
  ${WEBPACK} --progress --colors ${INDEXJS} ${BUNDLE_MIN}
  # ${WEBPACK} --progress --colors --env.fileName 'suga.js' --env.libName 'suga'
  # ${WEBPACK} --progress --colors -p --env.fileName 'suga.min.js' --env.libName 'suga'
}

function public:test {
  mocha-webpack --opts './test/mocha.opts' --glob "*.test.js" test || { echo 'Test failed' ; exit 1; }
}

function public:lint {
  # eslint scripts src test --max-warnings 0
  eslint src --fix --max-warnings 0
}

function public:lib {
  rm -rf ./lib && babel src --out-dir lib -s
}

function public:docs {
  rm -rf ./docs && jsdoc -c ./jsdoc.json -R README.md
}

# ------------------------------------------
# DEFAULT public: list all possible commands
#
function public:help {
    echo "$0 <task> <args>"
    echo "Tasks:"
    compgen -A function | sed -En 's/public:(.*)/\1/p' | cat -n
}

# ---------- Do NOT edit below --------------

TIMEFORMAT="Task completed in %3lR"
time "public:${@:-help}" # make help default
